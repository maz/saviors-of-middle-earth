// Generated by CoffeeScript 1.4.0
(function() {
  var FONTS, RichTextEditor,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  FONTS = ["Arial", "Comic Sans MS", "Courier New", "Georiga", "Impact", "Times New Roman", "Trebuchet", "Verdana", "Webdings"];

  RichTextEditor = (function() {

    function RichTextEditor(field) {
      this.queryEverything = __bind(this.queryEverything, this);

      var font, html, opt, queryEverythingLater, _i, _len,
        _this = this;
      this.container = field;
      html = field.innerHTML;
      field.innerHTML = "";
      this.toolbar = document.createElement('div');
      this.toolbar.className = 'toolbar';
      this.fontName = document.createElement('select');
      for (_i = 0, _len = FONTS.length; _i < _len; _i++) {
        font = FONTS[_i];
        opt = document.createElement('option');
        opt.value = font;
        opt.textContent = font;
        this.fontName.appendChild(opt);
      }
      this.toolbar.appendChild(this.fontName);
      this.fontName.addEventListener('change', function() {
        return _this.exec('fontName', FONTS[_this.fontName.selectedIndex]);
      }, false);
      this.container.appendChild(this.toolbar);
      this.iframe = document.createElement('iframe');
      field.appendChild(this.iframe);
      this.iframe.src = "/html/blank.html";
      queryEverythingLater = function() {
        return setTimeout(_this.queryEverything, 0);
      };
      this.iframe.addEventListener('load', function() {
        _this.win = _this.iframe.contentWindow;
        _this.doc = _this.win.document;
        _this.doc.body.innerHTML = html;
        _this.doc.designMode = 'on';
        _this.exec('styleWithCSS', true);
        queryEverythingLater();
        _this.doc.body.addEventListener('keydown', queryEverythingLater, false);
        return _this.doc.body.addEventListener('mouseup', queryEverythingLater, false);
      }, false);
    }

    RichTextEditor.prototype.exec = function(cmd, arg) {
      return this.doc.execCommand(cmd, null, arg);
    };

    RichTextEditor.prototype.queryEverything = function() {
      return this.fontName.selectedIndex = FONTS.indexOf(this.doc.queryCommandValue('fontName').replace(/'/g, ""));
    };

    return RichTextEditor;

  })();

  window.addEventListener('load', function() {
    var field, _i, _len, _ref, _results;
    _ref = document.querySelectorAll('.rich-text');
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      field = _ref[_i];
      _results.push(new RichTextEditor(field));
    }
    return _results;
  }, false);

}).call(this);
